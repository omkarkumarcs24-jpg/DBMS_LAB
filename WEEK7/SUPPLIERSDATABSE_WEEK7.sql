
CREATE DATABASE SUPPLIER;
USE SUPPLIER;

CREATE TABLE SUPPLIERS (
SID INT PRIMARY KEY,
SNAME VARCHAR(50) NOT NULL,
CITY VARCHAR(100) NOT NULL
);

CREATE TABLE PARTS(
PID INT PRIMARY KEY,
PNAME VARCHAR(50) NOT NULL ,
COLOR VARCHAR(50) NOT NULL
);

CREATE TABLE CATALOG(
SID INT NOT NULL ,
PID INT NOT NULL,
COST INT NOT NULL,
CONSTRAINT fk_sid  FOREIGN KEY(SID) REFERENCES SUPPLIERS(SID),
CONSTRAINT fk_pid  FOREIGN KEY (PID)  REFERENCES PARTS(PID)
);

INSERT INTO SUPPLIERS VALUES 
(10001 , 'Acme Widget' , 'Banglore'),
(10002 , 'Johns' ,  'kolkata'),
(10003 , 'Vimal' , 'Mumbai'),
(10004 , 'Reliance' , 'Delhi');

INSERT INTO PARTS VALUES
(20001 , 'Book', 'Red'),
(20002 , 'Pen', 'Red'),
(20003 , 'Pencil', 'Green'),
(20004 , 'Mobile', 'Green'),
(20005 , 'Charger', 'Black');

INSERT INTO CATALOG VALUES
(10001, 20001 , 10),
(10001, 20002 , 10),
(10001, 20003 , 30),
(10001, 20004 , 10),
(10001, 20005 , 10),
(10002, 20001 , 10),
(10002, 20002 , 20),
(10003, 20003 , 30),
(10004, 20003 , 40);

-- QUERIES ON SUPPLIER DATABASE

-- 3 
SELECT DISTINCT P.PNAME 
FROM PARTS P
JOIN CATALOG C ON P.PID = C.PID;

-- 4 
SELECT S.SNAME FROM SUPPLIERS S
WHERE NOT EXISTS ( SELECT * FROM PARTS P WHERE NOT EXISTS (
        SELECT * FROM CATALOG C
        WHERE C.SID = S.SID AND C.PID = P.PID
    )
);

-- 5
SELECT S.SNAME FROM SUPPLIERS S
WHERE NOT EXISTS ( SELECT * FROM PARTS P WHERE P.COLOR = 'Red'
      AND NOT EXISTS ( SELECT * FROM CATALOG C
          WHERE C.SID = S.SID AND C.PID = P.PID)
);

-- 6
SELECT P.PNAME FROM PARTS P
JOIN CATALOG C ON P.PID = C.PID
JOIN SUPPLIERS S ON S.SID = C.SID
WHERE S.SNAME = 'Acme Widget'
AND P.PID NOT IN (
    SELECT C.PID FROM CATALOG C
    JOIN SUPPLIERS S ON S.SID = C.SID
    WHERE S.SNAME <> 'Acme Widget'
);

-- 7
SELECT DISTINCT C.SID
FROM CATALOG C
JOIN (
    SELECT PID, AVG(COST) AS AVG_COST
    FROM CATALOG
    GROUP BY PID
) AS AVG_C ON C.PID = AVG_C.PID
WHERE C.COST > AVG_C.AVG_COST;

-- 8
SELECT P.PNAME, S.SNAME
FROM PARTS P
JOIN CATALOG C ON P.PID = C.PID
JOIN SUPPLIERS S ON S.SID = C.SID
WHERE C.COST = (
    SELECT MAX(D.COST)
    FROM CATALOG D
    WHERE D.PID = C.PID
);


